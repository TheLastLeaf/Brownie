<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.brownie.teamGame.service.impl.TeamGameMapper">
    <insert id="insertTeamGameRoom">
        INSERT ALL
            INTO TEAMGAME_POSITION ( POSITION_SEQ
                                   , TOP
                                   , MID
                                   , JUN
                                   , BOT
                                   , SUP)
        VALUES ( POSITION_SEQ.NEXTVAL
               , #{top}
               , #{mid}
               , #{jun}
               , #{bot}
               , #{sup})
        INTO TEAMGAME ( TEAMGAME_SEQ
                      , USER_ID
                      , TITLE
                      , MATCH_MODE
                      , MESSAGE
                      , POSITION_SEQ
                      , POSITION
                      , STATUS
                      , LEADER
                      , MIKE
                      , USE_POINT
                      , IN_DATE
                      , IN_USER_ID
                      , UP_DATE
                      , UP_USER_ID)
        VALUES ( TEAMGAME_SEQ.NEXTVAL
               , #{userId}
               , #{title}
               , #{matchMode}
               , #{message}
               , POSITION_SEQ.CURRVAL
               , #{position}
               , #{status}
               , #{leader}
               , #{mike}
               , #{usePoint}
               , SYSDATE
               , #{userId}
               , SYSDATE
               , #{userId})
        SELECT *
        FROM DUAL
        <selectKey keyProperty="TEAMGAME_SEQ" resultType="integer"  order="AFTER">
            SELECT TEAMGAME_SEQ.CURRVAL from dual
        </selectKey>
    </insert>


    <select id="selectTeamGameList" resultType="kr.co.brownie.teamGame.service.TeamGameVO">
        select *
        from (
                 select BU.LOL_ID as lolId
                      , BU.NICK_NAME as nickName
                      , TG.TEAMGAME_SEQ as teamGameSeq
                      , TG.USER_ID      as userId
                      , TG.TITLE        as title
                      , TG.MATCH_MODE   as matchMode
                      , TG.MESSAGE      as message
                      , TG.POSITION_SEQ as positionSeq
                      , TG.STATUS       as status
                      , TG.LEADER       as leader
                      , TG.MIKE         as mike
                      , TG.USE_POINT    as usePoint
                      , TG.IN_DATE      as inDate
                      , TG.IN_USER_ID   as inUserId
                      , TG.UP_DATE      as modDate
                      , TG.UP_USER_ID   as upUserId
                 from TEAMGAME TG, BROWNIE_USER BU
                 where TG.USER_ID = BU.USER_ID
                   and USE_POINT = 'y'
                   and LEADER = 'y'
                 order by TEAMGAME_SEQ desc
             )
        union all
        select *
        from (
                 select BU.LOL_ID as lolId
                      , BU.NICK_NAME as nickName
                      , TG.TEAMGAME_SEQ as teamgameSeq
                      , TG.USER_ID      as userId
                      , TG.TITLE        as title
                      , TG.MATCH_MODE   as matchMode
                      , TG.MESSAGE      as message
                      , TG.POSITION_SEQ as positionSeq
                      , TG.STATUS       as status
                      , TG.LEADER       as leader
                      , TG.MIKE         as mike
                      , TG.USE_POINT    as usePoint
                      , TG.IN_DATE      as inDate
                      , TG.IN_USER_ID   as inUserId
                      , TG.UP_DATE      as modDate
                      , TG.UP_USER_ID   as upUserId
                 from teamgame TG, BROWNIE_USER BU
                 where TG.USER_ID = BU.USER_ID
                   and USE_POINT = 'n'
                   and LEADER = 'y'
                 order by TEAMGAME_SEQ desc
             )

    </select>

    <select id="selectTeamGamePosition" resultType="kr.co.brownie.teamGame.service.TeamGameVO">
        SELECT POSITION_SEQ as positionSeq
             , TOP          as top
             , MID          as mid
             , JUN          as jun
             , BOT          as bot
             , SUP          as sup
        FROM TEAMGAME_POSITION
        WHERE POSITION_SEQ = #{positionSeq}
    </select>

    <insert id="insertMemberPosi">
        INSERT INTO TEAMGAME ( TEAMGAME_SEQ
                             , USER_ID
                             , POSITION_SEQ
                             , POSITION
                             , STATUS
                             , IN_DATE
                             , IN_USER_ID
                             , UP_DATE
                             , UP_USER_ID)
        VALUES ( #{positionSeq}
               , #{userId}
               , #{positionSeq}
               , #{position}
               , 'y'
               , SYSDATE
               , #{userId}
               , SYSDATE
               , #{userId})

    </insert>

    <update id="updateTeamGamePosition">
        UPDATE TEAMGAME_POSITION
        SET ${position} = 'y'
        WHERE POSITION_SEQ = #{positionSeq}
    </update>

</mapper>