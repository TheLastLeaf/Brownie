<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.brownie.teamGame.service.impl.TeamGameMapper">
    <insert id="insertTeamGameRoom">
        INSERT ALL
            INTO TEAMGAME_POSITION ( POSITION_SEQ
                                   , TOP
                                   , MID
                                   , JUN
                                   , BOT
                                   , SUP)
        VALUES ( POSITION_SEQ.NEXTVAL
               , #{top}
               , #{mid}
               , #{jun}
               , #{bot}
               , #{sup})
        INTO TEAMGAME ( TEAMGAME_SEQ
                      , USER_ID
                      , TITLE
                      , MATCH_MODE
                      , MESSAGE
                      , POSITION_SEQ
                      , STATUS
                      , LEADER
                      , USE_POINT
                      , IN_DATE
                      , IN_USER_ID
                      , UP_DATE
                      , UP_USER_ID)
        VALUES ( TEAMGAME_SEQ.NEXTVAL
               , #{userId}
               , #{title}
               , #{matchMode}
               , #{message}
               , POSITION_SEQ.CURRVAL
               , #{status}
               , #{leader}
               , #{usePoint}
               , SYSDATE
               , #{userId}
               , SYSDATE
               , #{userId})
        SELECT *
        FROM DUAL
        <selectKey keyProperty="TEAMGAME_SEQ" resultType="integer"  order="AFTER">
            SELECT TEAMGAME_SEQ.CURRVAL from dual
        </selectKey>
    </insert>


    <select id="selectTeamGameList" resultType="kr.co.brownie.teamGame.service.TeamGameVO">
        select *
        from (
                 select TEAMGAME_SEQ as teamGameSeq
                      , USER_ID      as userId
                      , TITLE        as title
                      , MATCH_MODE   as matchMode
                      , MESSAGE      as message
                      , POSITION_SEQ as positionSeq
                      , STATUS       as status
                      , LEADER       as leader
                      , USE_POINT    as usePoint
                      , IN_DATE      as inDate
                      , IN_USER_ID   as inUserId
                      , UP_DATE      as modDate
                      , UP_USER_ID   as upUserId
                 from teamgame
                 where USE_POINT = 'y'
                   and LEADER = 'y'
                 order by TEAMGAME_SEQ desc
             )
        union all
        select *
        from (
                 select TEAMGAME_SEQ as teamgameSeq
                      , USER_ID      as userId
                      , TITLE        as title
                      , MATCH_MODE   as matchMode
                      , MESSAGE      as message
                      , POSITION_SEQ as positionSeq
                      , STATUS       as status
                      , LEADER       as leader
                      , USE_POINT    as usePoint
                      , IN_DATE      as inDate
                      , IN_USER_ID   as inUserId
                      , UP_DATE      as modDate
                      , UP_USER_ID   as upUserId
                 from teamgame
                 where USE_POINT = 'n'
                   and LEADER = 'y'
                 order by TEAMGAME_SEQ desc
             )

    </select>

    <select id="selectTeamGamePosition" resultType="kr.co.brownie.teamGame.service.TeamGameVO">
        SELECT POSITION_SEQ as positionSeq
             , TOP          as top
             , MID          as mid
             , JUN          as jun
             , BOT          as bot
             , SUP          as sup
        FROM TEAMGAME_POSITION
        WHERE POSITION_SEQ = #{positionSeq}
    </select>

    <update id="updateTeamGamePosition">
        UPDATE TEAMGAME_POSITION
        SET ${position} = 'y'
        WHERE POSITION_SEQ = #{positionSeq}
    </update>

</mapper>