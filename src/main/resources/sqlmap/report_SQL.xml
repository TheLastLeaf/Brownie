<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.brownie.report.service.impl.ReportMapper">

    <select id="selectReportList" resultType="kr.co.brownie.report.service.ReportVO" parameterType="hashMap">
        <![CDATA[
        SELECT REPORTSEQ,
               CONTENT,
               STATUS,
               REPORTNAME,
               USERID,
               INDATE,
               "UPDATE",
               INUSERID,
               UPUSERID,
               LOG
        FROM (SELECT ROWNUM AS RN,
                     REPORTSEQ,
                     CONTENT,
                     STATUS,
                     REPORTNAME,
                     USERID,
                     INDATE,
                     "UPDATE",
                     INUSERID,
                     UPUSERID,
                     LOG
              FROM (SELECT REPORT_SEQ  as REPORTSEQ,
                           CONTENT     as CONTENT,
                           STATUS      as STATUS,
                           REPORT_NAME as REPORTNAME,
                           USER_ID     as USERID,
                           IN_DATE     as INDATE,
                           UP_DATE     as "UPDATE",
                           IN_USER_ID  as INUSERID,
                           UP_USER_ID  as UPUSERID,
                           LOG         as "LOG"
                    FROM REPORT
                    order by STATUS, IN_DATE
                   )
             )
        WHERE ${contentPerPage} * (${currentPageNumber} - 1) < RN
          AND RN <= ${contentPerPage} * ${currentPageNumber}
        ]]>

    </select>

    <select id="count" resultType="int">
        SELECT COUNT(*)
        FROM REPORT
        WHERE STATUS = 'N'
    </select>

    <insert id="insert" parameterType="hashMap">
        <![CDATA[
        INSERT INTO REPORT(REPORT_SEQ, CONTENT, REPORT_NAME, USER_ID, IN_DATE, UP_DATE, IN_USER_ID, UP_USER_ID, STATUS,LOG)
        VALUES (REPORT_SEQ.NEXTVAL, #{content}, #{reportName}, #{userId}, sysdate, sysdate, #{id}, #{id}, 'N',#{log})
        ]]>
    </insert>

    <update id="update" parameterType="hashMap">
        UPDATE REPORT
        SET UP_USER_ID = #{id},
            UP_DATE = SYSDATE,
            STATUS = 'Y'
        WHERE REPORT_SEQ = #{reportSeq}
    </update>


</mapper>