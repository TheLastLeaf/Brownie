<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.brownie.board.service.impl.BoardMapper">

	<select id="likeHateCnt" resultType="kr.co.brownie.board.service.BoardVO">
		SELECT BOARD_SEQ, "0" as likecnt, "1" as HATECNT
		FROM (SELECT BOARD_SEQ, KIND
		FROM LIKE_BOARD)
		PIVOT (
		    COUNT(*)
		    FOR KIND
		    IN (0, 1)
		)
		WHERE BOARD_SEQ = #{boardSeq}
	</select>


	<select id="selectUserStance" resultType="kr.co.brownie.board.service.BoardVO">
		SELECT
			BOARD_SEQ as boardSeq,
			KIND as likeHateKind,
			IN_DATE as inDate,
			IN_USER_ID as inUserId,
			UP_DATE as modDate,
			UP_USER_ID as upUserId
		FROM
			LIKE_BOARD
        WHERE
        	BOARD_SEQ = #{boardSeq}
        AND
        	IN_USER_ID = #{inUserId}
	</select>

	<delete id="deleteUserStance">
		DELETE FROM LIKE_BOARD
        WHERE
        	BOARD_SEQ = #{boardSeq}
        AND
        	IN_USER_ID = #{inUserId}
	</delete>

	<update id="updateLikeHate" parameterType="hashMap">
		MERGE INTO
			like_board
		USING dual
		ON
			(BOARD_SEQ = #{boardSeq} and IN_USER_ID = #{inUserId})
		WHEN MATCHED THEN
			UPDATE SET
				UP_USER_ID = #{inUserId},
				kind = #{kind}
		WHEN NOT MATCHED THEN
			INSERT (
				BOARD_SEQ,
				KIND,
				IN_DATE,
				IN_USER_ID,
				UP_DATE,
				UP_USER_ID
			) values(
				#{boardSeq},
				#{kind},
				sysdate,
				#{inUserId},
				sysdate,
				#{inUserId}
			)
	</update>

</mapper>