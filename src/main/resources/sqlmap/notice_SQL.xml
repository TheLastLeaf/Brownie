<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.brownie.notice.service.impl.NoticeMapper">
    <select id="selectList" resultType="kr.co.brownie.notice.service.NoticeVO" parameterType="hashMap">
        <![CDATA[
        SELECT BOARDSEQ,
               BOARDKIND,
               BOARDCATEGORY,
               TITLE,
               CONTENT,
               NOTICEYN,
               STATUS,
               INDATE,
               INUSERID,
               "UPDATE",
               UPUSERID,
               FILESEQ,
               SUBSEQ
        FROM (SELECT ROWNUM AS RN,
                     BOARDSEQ,
                     BOARDKIND,
                     BOARDCATEGORY,
                     TITLE,
                     CONTENT,
                     NOTICEYN,
                     STATUS,
                     INDATE,
                     INUSERID,
                     "UPDATE",
                     UPUSERID,
                     FILESEQ,
                     SUBSEQ
              FROM (SELECT BOARD_SEQ      AS BOARDSEQ,
                           BOARD_KIND     AS BOARDKIND,
                           BOARD_CATEGORY AS BOARDCATEGORY,
                           TITLE          AS TITLE,
                           CONTENT        AS CONTENT,
                           NOTICE_YN      AS NOTICEYN,
                           STATUS         AS STATUS,
                           IN_DATE        AS INDATE,
                           IN_USER_ID     AS INUSERID,
                           UP_DATE        AS "UPDATE",
                           UP_USER_ID     AS UPUSERID,
                           FILE_SEQ       AS FILESEQ,
                           SUB_SEQ        AS SUBSEQ
                    FROM BROWNIE_BOARD
                    WHERE BOARD_KIND = 'notice'
                      AND LOWER(TITLE) LIKE LOWER('%' || #{keyword} || '%')
                    ORDER BY BOARD_SEQ DESC
                   )
             )
        WHERE ${contentPerPage} * (${currentPageNumber} - 1) < RN
          AND RN <= ${contentPerPage} * ${currentPageNumber}
        ]]>
    </select>

    <select id="count" parameterType="String" resultType="int">
        SELECT COUNT(*)
        FROM BROWNIE_BOARD
        WHERE BOARD_KIND = 'notice'
          AND LOWER(TITLE) LIKE LOWER('%' || #{keyword} || '%')
    </select>

    <select id="read" parameterType="int" resultType="kr.co.brownie.notice.service.NoticeVO">
        SELECT BOARD_SEQ  AS BOARDSEQ,
               BOARD_KIND AS BOARDKIND,
               TITLE      AS TITLE,
               CONTENT    AS CONTENT,
               NOTICE_YN  AS NOTICEYN,
               STATUS     AS STATUS,
               IN_DATE    AS INDATE,
               IN_USER_ID AS INUSERID,
               UP_DATE    AS "UPDATE",
               UP_USER_ID AS UPUSERID,
               FILE_SEQ   AS FILESEQ,
               SUB_SEQ    AS SUBSEQ
        FROM BROWNIE_BOARD
        WHERE BOARD_SEQ = #{boardSeq}
    </select>

    <select id="nickname" resultType="String">
        SELECT DISTINCT A.NICK_NAME AS NICKNAME
        FROM BROWNIE_USER A,
             BROWNIE_BOARD B
        WHERE A.USER_ID = B.IN_USER_ID
    </select>
    <insert id="insert" parameterType="hashMap">
        <selectKey order="BEFORE" keyProperty="boardSeq" resultType="int">
            SELECT NVL(MAX(BOARD_SEQ),0)+1 FROM BROWNIE_BOARD
        </selectKey>
        INSERT INTO
        BROWNIE_BOARD(BOARD_SEQ,BOARD_KIND,TITLE,CONTENT,NOTICE_YN,STATUS,IN_DATE,IN_USER_ID,UP_DATE,UP_USER_ID,FILE_SEQ,SUB_SEQ)
        VALUES (#{boardSeq},'notice',#{title},#{content},NULL,NULL,SYSDATE,#{inUserId},SYSDATE,#{inUserId},NULL,NULL)
    </insert>

    <update id="update" parameterType="hashMap">
        UPDATE BROWNIE_BOARD
        SET BOARD_KIND = 'notice',
            TITLE      = #{title},
            CONTENT    = #{content},
            NOTICE_YN  = 1,
            STATUS     = 1,
            UP_DATE    = SYSDATE,
            FILE_SEQ   = NULL,
            SUB_SEQ    = NULL
        WHERE BOARD_SEQ = #{boardSeq}
    </update>

    <delete id="delete" parameterType="int">
        DELETE
        FROM BROWNIE_BOARD
        WHERE BOARD_SEQ = #{Seq}
    </delete>
</mapper>
