<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.brownie.review.service.impl.ReviewMapper">
	<select id="selectReviewList" resultType="kr.co.brownie.review.service.ReviewVO">
		SELECT a.reviewSeq, a.userId, a.starCnt, a.reply, a.inDate, b.nick_name as inUserId
			FROM(
			    SELECT 
			        reviewSeq, userId, starCnt, reply, inDate, inUserId
			    FROM(
			        select 
			            REVIEW_SEQ 	AS reviewSeq,
			            USER_ID 	AS userId,
			            STAR_CNT 	AS starCnt,
			            REPLY 		AS reply,
			            IN_DATE 	AS inDate,
			            IN_USER_ID 	AS inUserId,
			            row_number()over(order by user_id desc) as rNum
			        FROM REVIEW
			        ) rv
			    WHERE userId = '${id}' AND rNum BETWEEN ${startPost} and ${endPost}) a, BROWNIE_USER b
				WHERE a.inUserId = b.user_id
				<if test='searchType.equals("writerId")'>
				AND LOWER(b.nick_name) LIKE LOWER('%'||'${keyword}'||'%')
				</if>
				<if test='searchType.equals("writeDate")'>
				AND inDate = '${keyword}'
				</if>
				ORDER BY inDate DESC
	</select>
	
	<select id="countAllReview" resultType="int">
		SELECT COUNT(*)
		FROM(
		    SELECT r.USER_ID, r.IN_USER_ID, b.nick_name, r.IN_DATE
		    FROM review r, brownie_user b
		    WHERE  b.user_id = r.in_user_id
		    AND r.user_id = '${id}'
		    )
		<if test='searchType.equals("writerId")'>
		where LOWER(nick_name) LIKE LOWER('%'||'${keyword}'||'%')
		</if>
		<if test='searchType.equals("writeDate")'>
		WHERE IN_DATE = '${keyword}'
		</if>
	</select>
</mapper>